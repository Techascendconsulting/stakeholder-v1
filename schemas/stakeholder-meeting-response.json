{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "required": [
    "stakeholder_response",
    "question_evaluation",
    "coaching_feedback",
    "suggested_follow_ups",
    "context_updates",
    "system_actions"
  ],
  "properties": {
    "stakeholder_response": {
      "type": "object",
      "required": ["speaker_id", "speaker_name", "content"],
      "properties": {
        "speaker_id": {
          "type": "string",
          "description": "Stakeholder ID (e.g., 'james-walker')"
        },
        "speaker_name": {
          "type": "string",
          "description": "Stakeholder display name"
        },
        "content": {
          "type": "string",
          "description": "The stakeholder's response message"
        },
        "metadata": {
          "type": "object",
          "properties": {
            "stage": {
              "type": "string",
              "enum": ["kickoff", "problem_exploration", "as_is", "to_be", "wrap_up"]
            },
            "emotion": {
              "type": "string",
              "enum": ["frustrated", "neutral", "optimistic", "concerned"]
            },
            "information_layer": {
              "type": "number",
              "minimum": 1,
              "maximum": 5
            },
            "keywords": {
              "type": "array",
              "items": { "type": "string" }
            },
            "pain_points_revealed": {
              "type": "array",
              "items": { "type": "string" }
            }
          }
        }
      }
    },
    "question_evaluation": {
      "type": "object",
      "required": ["verdict", "overall_score", "breakdown", "triggers", "reasons"],
      "properties": {
        "verdict": {
          "type": "string",
          "enum": ["GREEN", "AMBER", "RED"]
        },
        "overall_score": {
          "type": "number",
          "minimum": 0,
          "maximum": 100
        },
        "breakdown": {
          "type": "object",
          "required": ["stage_alignment", "question_type", "specificity", "neutrality"],
          "properties": {
            "stage_alignment": { "type": "number", "minimum": 0, "maximum": 30 },
            "question_type": { "type": "number", "minimum": 0, "maximum": 30 },
            "specificity": { "type": "number", "minimum": 0, "maximum": 20 },
            "neutrality": { "type": "number", "minimum": 0, "maximum": 20 }
          }
        },
        "triggers": {
          "type": "array",
          "items": { "type": "string" }
        },
        "reasons": {
          "type": "array",
          "items": { "type": "string" }
        },
        "suggested_rewrite": {
          "type": "string"
        }
      }
    },
    "coaching_feedback": {
      "type": "object",
      "required": ["verdict_label", "summary", "what_happened", "why_it_matters", "what_to_do", "principle", "action", "acknowledgement_required"],
      "properties": {
        "verdict_label": { "type": "string" },
        "summary": { "type": "string" },
        "what_happened": { "type": "string" },
        "why_it_matters": { "type": "string" },
        "what_to_do": { "type": "string" },
        "suggested_rewrite": { "type": "string", "nullable": true },
        "rewrite_explanation": { "type": "string", "nullable": true },
        "principle": { "type": "string" },
        "action": {
          "type": "string",
          "enum": ["CONTINUE", "ACKNOWLEDGE_AND_RETRY", "PAUSE_FOR_COACHING"]
        },
        "acknowledgement_required": { "type": "boolean" }
      }
    },
    "suggested_follow_ups": {
      "type": "array",
      "minItems": 3,
      "maxItems": 3,
      "items": {
        "type": "object",
        "required": ["type", "question", "rationale"],
        "properties": {
          "type": {
            "type": "string",
            "enum": ["probe_deeper", "clarify", "explore_impact", "check_scope", "transition"]
          },
          "question": { "type": "string" },
          "rationale": { "type": "string" }
        }
      }
    },
    "context_updates": {
      "type": "object",
      "required": ["topics_covered", "pain_points_identified", "information_layers_unlocked", "stage_progress", "should_transition"],
      "properties": {
        "topics_covered": {
          "type": "array",
          "items": { "type": "string" }
        },
        "pain_points_identified": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "area": { "type": "string" },
              "impact": { "type": "string" },
              "emotion": { "type": "string" },
              "layer": { "type": "number", "minimum": 1, "maximum": 5 }
            }
          }
        },
        "information_layers_unlocked": { "type": "number", "minimum": 1, "maximum": 5 },
        "stage_progress": {
          "type": "object",
          "properties": {
            "problem_exploration": {
              "type": "object",
              "properties": {
                "pain_points_found": { "type": "number" },
                "target": { "type": "number" },
                "percent_complete": { "type": "number" }
              }
            },
            "as_is": {
              "type": "object",
              "properties": {
                "process_steps_mapped": { "type": "number" },
                "target": { "type": "number" },
                "percent_complete": { "type": "number" }
              }
            },
            "to_be": {
              "type": "object",
              "properties": {
                "improvements_discussed": { "type": "number" },
                "target": { "type": "number" },
                "percent_complete": { "type": "number" }
              }
            }
          }
        },
        "should_transition": { "type": "boolean" },
        "next_milestone": { "type": "string" }
      }
    },
    "system_actions": {
      "type": "object",
      "required": ["update_conversation_history", "lock_user_input", "show_coaching_panel", "trigger_stage_transition"],
      "properties": {
        "update_conversation_history": { "type": "boolean" },
        "lock_user_input": { "type": "boolean" },
        "show_coaching_panel": { "type": "boolean" },
        "trigger_stage_transition": { "type": "boolean" },
        "log_analytics": {
          "type": "object",
          "properties": {
            "question_quality": { "type": "string" },
            "stage": { "type": "string" },
            "time_in_stage_seconds": { "type": "number" },
            "information_revealed": { "type": "string" }
          }
        }
      }
    }
  }
}

